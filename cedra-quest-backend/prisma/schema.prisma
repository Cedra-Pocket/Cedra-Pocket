generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model quests {
  id            Int              @id @default(autoincrement())
  title         String           @db.VarChar(255)
  description   String?
  type          quest_type
  category      String?          @db.VarChar(50)
  config        Json?            @default("{}")
  reward_amount Decimal          @db.Decimal(20, 2)
  reward_type   String?          @default("POINT") @db.VarChar(20)
  frequency     quest_frequency? @default(ONCE)
  is_active     Boolean?         @default(true)
  created_at    DateTime?        @default(now()) @db.Timestamptz(6)
  user_quests   user_quests[]
}

model referral_logs {
  id                BigInt    @id @default(autoincrement())
  referrer_id       BigInt?
  referee_id        BigInt?
  source_action     String?   @db.VarChar(50)
  commission_amount Decimal   @db.Decimal(20, 2)
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
}

model user_quests {
  id           BigInt        @id @default(autoincrement())
  user_id      BigInt
  quest_id     Int
  status       quest_status? @default(PENDING)
  proof_data   Json?
  completed_at DateTime?     @db.Timestamptz(6)
  claimed_at   DateTime?     @db.Timestamptz(6)
  created_at   DateTime?     @default(now()) @db.Timestamptz(6)
  users        users         @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  quests       quests        @relation(fields: [quest_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  @@unique([user_id, quest_id], map: "unique_user_quest")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id                  BigInt    @id @default(autoincrement())
  telegram_id         String    @unique(map: "uq_telegram_id") @db.VarChar(255)
  username            String?   @db.VarChar(255)
  wallet_address      String?   @unique @db.VarChar(66)
  is_wallet_connected Boolean?  @default(false)
  total_points        Decimal?  @default(0) @db.Decimal(20, 2)
  current_rank        String?   @default("BRONZE") @db.VarChar(50)
  referral_code       String?   @unique @db.VarChar(20)
  referrer_id         BigInt?
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  users               users?    @relation("usersTousers", fields: [referrer_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_referrer")
  other_users         users[]   @relation("usersTousers")
  user_quests         user_quests[]
  @@index([referral_code], map: "idx_users_referral_code")
  @@index([telegram_id], map: "idx_users_telegram_id")
}

enum quest_frequency {
  ONCE
  DAILY
  WEEKLY
}

enum quest_status {
  PENDING
  COMPLETED
  FAILED
  CLAIMED
}

enum quest_type {
  SOCIAL
  ONCHAIN
}

enum user_role {
  USER
  ADMIN
}

enum user_status {
  ACTIVE
  BANNED
}
